(()=>{"use strict";var e={734:(e,t,n)=>{function i(e){return/^[01]{1,64}$/.test(e)}function a(e){return i(e)?parseInt(e,2).toString(10):NaN}function r(e,t){if("hex"==t)return r=function(e){return i(e)?parseInt(e,2).toString(16):NaN}(n=e),isNaN(r)?"x".repeat(Math.ceil(n.length/4)):r;var n,r;if("float"==t)return NaN;if("double"==t)return NaN;var o=t.match(/[us]\d+/);return o?function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))throw"Non-zero number of fractional digits is not supported yet.";if(t)throw"Signed format is not supported yet.";var n=a(e);return isNaN(n)?"x".repeat(Math.ceil(e.length/4)):n}(e,"s"==o[1],o[2]):void 0}function o(e){return!isNaN(e)&&parseInt(Number(e))==e&&!isNaN(parseInt(e,10))}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,{v:()=>P,O:()=>V});var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.references=t.references,this.vcdid=t.vcdid,this.type=t.type,this.wave=t.wave,this.width=t.width}var t,n;return t=e,(n=[{key:"cloneRange",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;n<0&&(n=t);var i=new e(this);return i.wave=[],i.width=n-t+1,i}},{key:"getChangeIndexAt",value:function(e){var t=function(e,t,n){for(var i=0,a=e.length-1;i<=a;){var r=a+i>>1,o=n(t,e[r]);if(o>0)i=r+1;else{if(!(o<0))return r;a=r-1}}return-i-1}(this.wave,e,(function(e,t){return e-t.time}));return t<0&&(t=-t-2),t}},{key:"getValueAt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"- NA -",i=this.getChangeIndexAt(e);return this.getValueAtI(i,t,n)}},{key:"getValueAtI",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bin",n=arguments.length>2?arguments[2]:void 0;if(e<0){if(void 0!==n)return n;throw"Negative index"}return e>=this.wave.length&&(e=this.wave.length-1),void 0===this.wave[e][t]&&(this.wave[e][t]=r(this.wave[e].bin,t)),this.wave[e][t]}},{key:"getTimeAtI",value:function(e){if(e<0)throw"Negative index";if(e<this.wave.length)return this.wave[e].time;if(e==this.wave.length)return V.now;throw"Index is too great"}}])&&s(t.prototype,n),e}();function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){function e(t,n,i,a){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.hierarchy=n,this.parent=a,this.signal=void 0,void 0!==i){switch(this.type){case e.Type.SIGNAL:this.signal=i instanceof l?i:new l(i);break;case e.Type.MODULE:break;default:throw"Unknown type ".concat(this.type)}this.definedAt=i.definedAt}}var t,n;return t=e,(n=[{key:"cloneRange",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;n<0&&(n=t);var i="[".concat(t,"]");n>t&&(i="[".concat(n,":").concat(t,"]"));var a=this.hierarchy.concat([i]),r=this.signal.cloneRange(t,n),o=new e(this.type,a,r,this);return o}},{key:"getChangeIndexAt",value:function(e){return this.signal.getChangeIndexAt(e)}},{key:"getValueAt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"- NA -";return this.signal.getValueAt(e,t,n)}},{key:"getValueAtI",value:function(e,t,n){return this.signal.getValueAtI(e,t,n)}},{key:"getTimeAtI",value:function(e){return this.signal.getTimeAtI(e)}},{key:"getTimeAnyTransition",value:function(e,t){var n=this.getChangeIndexAt(e);return t<0&&this.getTimeAtI(n)!=e&&t++,this.getTimeAtI(n+t)}}])&&c(t.prototype,n),e}();function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}u(d,"Type",Object.freeze({SIGNAL:"signal",MODULE:"module"})),u(d,"_idGenerator",0);var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(t)}var t,n;return t=e,(n=[{key:"init",value:function(e){var t=this;this.objects=[],this.now=-1,this.timePrecision=-1,this.timeUnit=-1,e&&(e.signals.forEach((function(e){e.references.forEach((function(n){var i=n.split(".");t.addSignal(i,e)}))})),this.now=e.now)}},{key:"addSignal",value:function(e,t){var n=e.join(".")+"__S",i=this.addModule(e.slice(0,-1)),a=new d(d.Type.SIGNAL,e,t,i);return this.objects[n]=a,a}},{key:"addModule",value:function(e){var t=e.join("."),n=null,i=this.getObject(e);return void 0!==i||(e.length>1&&(n=this.addModule(e.slice(0,-1))),i=new d(d.Type.MODULE,e,void 0,n),this.objects[t]=i),i}},{key:"isPathExist",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.join("."),i=n in this.objects;return t?1==e.length?i:i&&this.isPathExist(e.slice(0,-1)):i}},{key:"getObject",value:function(e){var t=e;return Array.isArray(e)&&(t=e.join(".")),this.objects[t]}},{key:"getAllSignals",value:function(){var e=[];for(var t in this.objects)if(Object.prototype.hasOwnProperty.call(this.objects,t)){var n=this.objects[t];n.type==d.Type.SIGNAL&&e.push(n.signal)}return e}},{key:"updateDBInitialX",value:function(){this.getAllSignals().forEach((function(e){var t=e.wave;0!=t.length?0!=t[0].time&&t.unshift({time:0,bin:"x"}):t.push({time:0,bin:"x"})}))}}])&&h(t.prototype,n),e}();function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.containerName="#object-tree",this.waveTable=t}var t,n;return t=e,(n=[{key:"showTree",value:function(){var e=[];for(var t in V.objects)if(Object.prototype.hasOwnProperty.call(V.objects,t)){var n=V.objects[t],i={};i.id=n.hierarchy,i.data=t,n.hierarchy.length>1?i.parent=n.hierarchy.slice(0,-1):i.parent="#",i.text=n.hierarchy[n.hierarchy.length-1],i.type=n.type,e.push(i)}$("#object-tree").jstree("destroy").empty(),$("#object-tree").jstree({plugins:["search","wholerow","types"],core:{data:e,animation:!1},types:{module:{icon:"glyphicon glyphicon-oil"},signal:{icon:"glyphicon glyphicon-leaf"},default:{}},search:{show_only_matches:!0,show_only_matches_children:!0}});var a=!1;$("#structure-search").keyup((function(){a&&clearTimeout(a),a=setTimeout((function(){var e=$("#structure-search").val();$("#object-tree").jstree(!0).search(e)}),150)}));var r=this;$.contextMenu({selector:"#main-container-tree",callback:function(e,t){switch(e){case"addToWave":r.waveTable.addObjects(r.getSelectedObjects());break;case"showInWave":break;default:console.log("unknown key: ".concat(e))}},zIndex:1100,items:{addToWave:{name:"Add to wave"},showInWave:{name:"Show in wave"}}})}},{key:"getSelectedObjects",value:function(){return this._getTree().get_selected(!0).map((function(e){return e.data}))}},{key:"_getTree",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return $(this.containerName).jstree(e)}}])&&f(t.prototype,n),e}();function m(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var b,k,T,R=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];y(this,e),this.id=t,this.data=n,this.parent=i,this.children=a,this.opened=r},A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#",n=arguments.length>1?arguments[1]:void 0;y(this,e),this._root=new R(t,n,null,[]),this._root.opened=!0,this.nodes={},this.nodes[t]=this._root}var t,n;return t=e,(n=[{key:"get",value:function(e){return null==e?this._root:(e.constructor==R&&(e=e.id),this.nodes[e])}},{key:"getId",value:function(e){return null==e?e=this._root:e.constructor!=R&&(e=this.nodes[e]),e.id}},{key:"getParent",value:function(e){return this.get(e).parent}},{key:"insert",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t=this.get(t),n<0&&(n=t.children.length);var a=new R(e,i,t,[]);this.nodes[e]=a,a.parent=t,t.children.splice(n,0,a)}},{key:"remove",value:function(e){var t=this,n=(e=this.get(e)).parent.children;n.splice(n.indexOf(e),1),this.getChildren(e).forEach((function(e){return delete t.nodes[e.id]})),delete this.nodes[e.id]}},{key:"move",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e=this.get(e),n=n?this.get(n):e.parent;var a=e.parent.children,r=a.indexOf(e);(i||n!=e.parent||t!=r)&&(a.splice(r,1),e.parent=n,n.children.splice(t,0,e))}},{key:"traverse",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Traverse.PREORDER,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[t=this.get(t)];return i==e.Traverse.SHALLOW?r:i==e.Traverse.PREORDER?((a||t.opened)&&r.push.apply(r,m(t.children.reduce((function(e,t){return e.push.apply(e,m(n.traverse(t,i))),e}),[]))),r):void 0}},{key:"getChildren",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Traverse.PREORDER,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=(t=this.get(t)).children.reduce((function(e,t){return e.concat(n.traverse(t,i,r))}),[]);return a?o.map((function(e){return e[a]})):o}},{key:"getVisible",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Traverse.PREORDER,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t||(t=this._root),this.getChildren(t,n,i,!1)}},{key:"open",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(e=this.get(e))!==this._root&&(e.opened=t)}},{key:"close",value:function(e){this.open(e,!1)}},{key:"openAll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(var t in this.nodes)this.open(t,e)}},{key:"closeAll",value:function(){this.openAll(!1)}},{key:"nodeList",value:function(){var e=this;return Object.values(this.nodes).filter((function(t){return t!=e._root}))}}])&&p(t.prototype,n),e}();function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}b=A,k="Traverse",T=Object.freeze({SHALLOW:"shallow",PREORDER:"preorder"}),k in b?Object.defineProperty(b,k,{value:T,enumerable:!0,configurable:!0,writable:!0}):b[k]=T;var S=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="signal",this.id="wfr-".concat(e._idGenerator++),this.simObj=t,this.radix="hex",this.waveStyle="",this.height=-1,this.name=t.hierarchy.join("."),this.setRadix(),1==t.signal.width?this.waveStyle="bit":this.waveStyle="bus"}var t,n;return t=e,(n=[{key:"getChangeIndexAt",value:function(e){return this.simObj.getChangeIndexAt(e)}},{key:"getValueAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"- NA -";return this.radixPrefix+this.simObj.getValueAt(e,this.radix,t)}},{key:"getValueAtI",value:function(e,t){return this.radixPrefix+this.simObj.getValueAtI(e,this.radix,t)}},{key:"getTimeAtI",value:function(e){return this.simObj.getTimeAtI(e)}},{key:"setRadix",value:function(e,t){if(1==this.simObj.signal.width)return this.radix="bin",void(this.radixPrefix="");void 0===e&&(e="hex"),e=e.toLowerCase(),["unsigned","u"].includes(e)?(e="u0",t=""):["signed","s","decimal"].includes(e)?(e="s0",t=""):e.startsWith("h")?t="0x":e.startsWith("b")&&(t="0b"),this.radix=e,this.radixPrefix=t}}])&&x(t.prototype,n),e}();function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:0,enumerable:!0,configurable:!0,writable:!0}):e[t]=0}(S,"_idGenerator");var j=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];_(this,e),this.containerName="#names-col-container-scroll",this.waveTable=t,n&&this.init()}var t,n;return t=e,(n=[{key:"init",value:function(){var e=this,t=this;$(this.containerName).jstree("destroy").empty(),$(this.containerName).jstree({plugins:["wholerow","dnd","changed"],core:{data:[],animation:!1,themes:{icons:!1},check_callback:function(e,t,n,i,a){return!a||!a.dnd||"i"!==a.pos&&n.id==t.parent}}}).on("move_node.jstree",(function(e,n){t.waveTable.moveRow(n.node.data,n.position)})).on("open_node.jstree",(function(e,n){t.waveTable.openGroup(n.node.data)})).on("close_node.jstree",(function(e,n){t.waveTable.closeGroup(n.node.data)})).on("changed.jstree",(function(e,n){n.changed.selected.forEach((function(e){var n=t._getTree().get_node(e).data;t.waveTable.selectRow(n)})),n.changed.deselected.forEach((function(e){var n=t._getTree().get_node(e).data;t.waveTable.deSelectRow(n)}))})),setTimeout((function(){e.reload()}),100)}},{key:"reload",value:function(){var e=this,t=[];this.waveTable.getRows().forEach((function(n){var i={};i.id=e.toId(n.id),"#"==n.parent.id?i.parent="#":i.parent=e.toId(n.parent.id),i.text=n.data.name,i.data=n.id,t.push(i)})),this._getTree().settings.core.data=t,clearTimeout(this.renderTimeout),this.renderTimeout=setTimeout((function(){e.refresh()}),10)}},{key:"refresh",value:function(){this._getTree().refresh()}},{key:"clearAll",value:function(){$(this.containerName).jstree("destroy").empty()}},{key:"selectRow",value:function(e){this._getTree().select_node(this.toId(e))}},{key:"deSelectRow",value:function(e){this._getTree().deselect_node(this.toId(e))}},{key:"moveRow",value:function(e,t){this.reload()}},{key:"openGroup",value:function(e){this._getTree().open_node(this.toId(e))}},{key:"closeGroup",value:function(e){this._getTree().select_node(this.toId(e))}},{key:"insertRow",value:function(e,t){this.reload()}},{key:"removeRow",value:function(e){this.removeRows(e)}},{key:"removeRows",value:function(e){this._getTree().delete_node(this.toId(e))}},{key:"getSelectedRows",value:function(){return this._getTree().get_selected(!0).map((function(e){return e.data}))}},{key:"getActiveRow",value:function(){return this._getTree().get_selected(!0)[0].data}},{key:"rename",value:function(e,t){this._getTree().rename_node(this.toId(e),t)}},{key:"toId",value:function(e){return"signal-name-".concat(e)}},{key:"_getTree",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return $(this.containerName).jstree(e)}},{key:"get_node",value:function(e){return this._getTree().get_node(this.toId(e))}},{key:"editName",value:function(e){var t=this,n="nameeditorinput",i=("#".concat(n),$("#".concat(this.toId(e))));i.find("a").toggle(),i.find("div").toggle();var a=$("<input></input>").attr("id",n).val(this.get_node(e).text).keypress((function(n){13==n.which&&t.editNameEnd(e),27==n.which&&t.editNameEnd(e,!1)})).focusout((function(n){t.editNameEnd(e,!1)}));i.append(a),a.focus(),a[0].setSelectionRange(0,1e3)}},{key:"editNameEnd",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=$("#".concat(this.toId(e))),i=n.find("input");i.val(),i.remove(),n.find("a").toggle(),n.find("div").toggle(),t&&this.waveTable.rename(e,i.val())}}])&&I(t.prototype,n),e}();function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var E=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];O(this,e),this.containerName="#values-col-container",this.waveTable=t,n&&this.init()}var t,n;return t=e,(n=[{key:"init",value:function(){var e=this,t=this;$(this.containerName).jstree("destroy").empty(),$(this.containerName).jstree({plugins:["wholerow","dnd","changed"],core:{data:[],animation:!1,themes:{icons:!1},check_callback:function(e,t,n,i,a){return!a||!a.dnd||"i"!==a.pos&&n.id==t.parent}}}).on("open_node.jstree",(function(e,n){t.waveTable.openGroup(n.node.data)})).on("close_node.jstree",(function(e,n){t.waveTable.closeGroup(n.node.data)})).on("changed.jstree",(function(e,n){n.changed.selected.forEach((function(e){var n=t._getTree().get_node(e).data;t.waveTable.selectRow(n)})),n.changed.deselected.forEach((function(e){var n=t._getTree().get_node(e).data;t.waveTable.deSelectRow(n)}))})),setTimeout((function(){e.reload()}),100)}},{key:"reload",value:function(){var e=this,t=[];this.waveTable.getRows().forEach((function(n){var i={};i.id=e.toId(n.id),"#"==n.parent.id?i.parent="#":i.parent=e.toId(n.parent.id),i.text=n.data.getValueAt(0),i.data=n.id,t.push(i)})),this._getTree().settings.core.data=t,clearTimeout(this.renderTimeout),this.renderTimeout=setTimeout((function(){e.refresh()}),10)}},{key:"refresh",value:function(){this._getTree().refresh()}},{key:"clearAll",value:function(){$(this.containerName).jstree("destroy").empty()}},{key:"selectRow",value:function(e){this._getTree().select_node(this.toId(e))}},{key:"deSelectRow",value:function(e){this._getTree().deselect_node(this.toId(e))}},{key:"moveRow",value:function(e,t){this.reload()}},{key:"openGroup",value:function(e){this._getTree().open_node(this.toId(e))}},{key:"closeGroup",value:function(e){this._getTree().close_node(this.toId(e))}},{key:"insertRow",value:function(e,t){this.reload()}},{key:"removeRow",value:function(e){this.removeRows(e)}},{key:"removeRows",value:function(e){this._getTree().delete_node(this.toId(e))}},{key:"getSelectedRows",value:function(){return this._getTree().get_selected(!0).map((function(e){return waveTable.get(e.data)}))}},{key:"getActiveRow",value:function(){return waveTable.get($(this.containerName).get_selected(!0)[0].data)}},{key:"showValuesAt",value:function(e){var t=this;void 0===e&&(e=this.waveTable.getCursorTime()),this.waveTable.getRows().forEach((function(n){t._getTree().rename_node(t.toId(n.id),n.data.getValueAt(e))}))}},{key:"toId",value:function(e){return"signal-value-".concat(e)}},{key:"_getTree",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return $(this.containerName).jstree(e)}},{key:"setRadix",value:function(e){this.showValuesAt()}}])&&C(t.prototype,n),e}();function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var z=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.waveTable=t,this.rowIdPrefix="#signalRow_",this.rowClass=".signalRow",this.zoom=d3.zoom(),this.x_grid=d3.axisBottom(),this.x_axis=d3.axisBottom(),this.initialTimeScale=d3.scaleLinear(),this.timeScale=d3.scaleLinear(),this.renderTimeScale=d3.scaleLinear(),this.bitWaveScale=d3.scaleLinear(),this.renderRange=[],this.renderDomain=[],this.dbg_enableUpdateRenderRange=!0,this.dbg_enableRender=!0}var t,n;return t=e,(n=[{key:"init",value:function(){this.renderRange=[0,V.now],this.renderDomain=[0,V.now],this.renderTimeScale.domain(this.renderDomain).range(this.renderRange),this.initialTimeScale.domain([0,V.now]).range([0,V.now]),this.timeScale.domain([0,V.now]).range([0,V.now]),this.bitWaveScale.domain([0,1]).range([P.rowHeight-P.bitWavePadding,P.bitWavePadding]),d3.select("#wave-axis-container").on("scroll",this.scrolled.bind(this)).call(this.zoom).on("wheel",(function(){d3.event.ctrlKey&&d3.event.preventDefault()})),this.zoom.scaleExtent([200/this.timeScale(V.now),20]).on("zoom",this.zoom_fast.bind(this)).filter((function(){return d3.event.ctrlKey|d3.event.type.startsWith("touch")})).on("end",this.zoom_end.bind(this));var e=d3.select("#mainGr");e.append("g").attr("id","grid-gr"),e.append("g").attr("id","signals-table"),e.append("g").attr("id","time-axis-gr-container"),e.append("g").attr("id","cursorGr")}},{key:"reload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d3.select("#mainGr").selectAll("g").selectAll("*").remove();var t=d3.select("#time-axis-gr-container");t.append("rect").attr("class","time-grid-shadow-rect").attr("x",0).attr("y",0).attr("width",this.initialTimeScale(V.now)).attr("height",20),t.append("g").attr("id","time-axis-gr");var n=this.waveTable.getRows({hidden:!1,content:!0});d3.select("#mainSVG").attr("width",V.now+200).attr("height",P.rowHeight*(n.length+1));var i=d3.select("#signals-table"),a=i.selectAll(".signalRow").data(n).enter().append("g").attr("transform",(function(e,t){return"translate(0, ".concat(t*P.rowHeight,")")})).attr("id",(function(e){return"signalRow_".concat(e.id)})).attr("class",(function(e){return"signalRow ".concat(e.id)})),r=a.append("g").attr("class","time-scale-group");r.append("g").attr("id",(function(e){return"signalWave_".concat(e.id)})).attr("class",(function(){return"signalWave"})),a.append("g").attr("class","signalValues"),r.append("g").attr("class","signal-highlighter-group").append("rect").attr("class","signal-highlighter signal-context-menu").attr("x",0).attr("y",0).attr("width",this.initialTimeScale(V.now)).attr("height",P.rowHeight),d3.select("#cursorGr").append("line").classed("cursor",!0).attr("id","main-cursor").attr("vector-effect","non-scaling-stroke").attr("y1",0).attr("y2",P.rowHeight*n.length);var o=this;d3.select("#mainGr").on("click",(function(){var e=o.timeScale.invert(d3.mouse(this)[0]);o.waveTable.moveCursorTo(e)})),e&&this.zoom.scaleBy(d3.select("#wave-axis-container"),1)}},{key:"refresh",value:function(){}},{key:"clearAll",value:function(){}},{key:"selectRow",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];d3.selectAll("".concat(this.rowClass,".").concat(e)).classed("highlighted-signal",t)}},{key:"deSelectRow",value:function(e){this.selectRow(e,!1)}},{key:"moveRow",value:function(e,t){this.reOrderSignals()}},{key:"reOrderSignals",value:function(){d3.select("#mainSVG").selectAll(".signalRow").data(this.waveTable.getRows({hidden:!1,content:!0}),(function(e){return e.id})).order().attr("transform",(function(e,t){return"translate(0, ".concat(t*P.rowHeight,")")}))}},{key:"openGroup",value:function(e){this.insertRow()}},{key:"closeGroup",value:function(e){this.removeRow()}},{key:"insertRow",value:function(e,t,n){var i=d3.select("#signals-table"),a=this.waveTable.getRows({hidden:!1,content:!0});i.selectAll(".signalRow").data(a,(function(e){return e.id})).enter().append("g").attr("id",(function(e){return"signalRow_".concat(e.id)})).attr("class",(function(e){return"signalRow ".concat(e.id)})).append("g").attr("class","time-scale-group"),this.reOrderSignals()}},{key:"removeRow",value:function(e){var t=this;d3.selectAll(".signalRow").filter((function(e){return!t.waveTable.getRows({hidden:!1,content:!0}).includes(e)})).remove(),this.reOrderSignals()}},{key:"getSelectedRows",value:function(){}},{key:"getActiveRow",value:function(){}},{key:"rename",value:function(e,t){}},{key:"setRadix",value:function(e){}},{key:"zoomFit",value:function(){var e=($("#wave-axis-container").width()-202)/V.now,t=d3.zoomIdentity;t.k=e,d3.select("#wave-axis-container").call(this.zoom.transform,t)}},{key:"zoomIn",value:function(){this.zoom.scaleBy(d3.select("#wave-axis-container"),1.3)}},{key:"zoomOut",value:function(){this.zoom.scaleBy(d3.select("#wave-axis-container"),1/1.3)}},{key:"zoomAutoscale",value:function(){var e=this.waveTable.getRows({hidden:!1,content:!0});if(e.length>0){var t=e.reduce((function(e,t){var n=t.simObj.signal;return n.wave.length?e+V.now/n.wave.length:1}),0)/e.length,n=500/t,i=d3.zoomIdentity;i.k=n,console.log("avgDelta: ".concat(t)),console.log("scale: ".concat(n)),console.log(i),d3.select("#wave-axis-container").call(this.zoom.transform,i)}}},{key:"updateRenderRange",value:function(){if(this.dbg_enableUpdateRenderRange){var e=d3.select("#wave-axis-container"),t=e.node().getBoundingClientRect().width,n=e.node().scrollLeft,i=n+t;this.renderRange=[n-200,i+200],this.renderDomain=[this.timeScale.invert(this.renderRange[0]),this.timeScale.invert(this.renderRange[1])],this.renderTimeScale.range(this.renderRange).domain(this.renderDomain),console.log(this.renderRange),console.log(this.renderDomain)}}},{key:"updateAxis",value:function(){var e=this.renderTimeScale.range()[1]-this.renderTimeScale.range()[0],t=$("#main-container-scroll-y").innerHeight()+$("#main-container-scroll-y").scrollTop();t=Math.min($("#wave-axis-container")[0].clientHeight,t),d3.select("#grid-gr").attr("transform","translate(0, ".concat(t-20,")")),d3.select("#time-axis-gr-container").attr("transform",(function(){return"translate(0, ".concat(t-20,")")})),this.x_grid.tickSize(-$("#mainSVG").height()).tickFormat(""),this.x_axis.scale(this.renderTimeScale).ticks(e/150),d3.select("#time-axis-gr").call(this.x_axis),this.x_grid.scale(this.renderTimeScale).ticks(e/300),d3.select("#grid-gr").call(this.x_grid)}},{key:"zoom_end",value:function(){console.log(d3.event),this.drawWave2()}},{key:"zoom_fast",value:function(){var e=this;console.log(d3.event);var t=d3.select("#wave-axis-container");this.timeScale.range([0,V.now*d3.event.transform.k]),d3.select("#mainSVG").attr("width",d3.event.transform.k*V.now+200),t.node().scrollLeft=-d3.event.transform.x,this.updateRenderRange(),d3.selectAll(".time-scale-group").attr("transform","scale("+d3.event.transform.k+",1)"),this.updateAxis(),d3.selectAll("#cursorGr").attr("transform","scale("+d3.event.transform.k+",1)"),d3.selectAll(".bus-value").attr("x",(function(t){return e.timeScale(t[0].getTimeAtI(t[1])+t[0].getTimeAtI(t[1]+1))/2}))}},{key:"scrolled",value:function(){var e=d3.select("#wave-axis-container");d3.zoomTransform(e.node()).x=-e.node().scrollLeft,this.updateRenderRange(),this.updateAxis()}},{key:"moveCursorTo",value:function(e){var t=d3.select("#cursorGr").select("#main-cursor");e>=0&&t.datum(e),t.attr("x1",(function(e){return e})).attr("x2",(function(e){return e}))}},{key:"getCursorTime",value:function(){var e=d3.select("#main-cursor").datum();return console.log(e),e}},{key:"drawWave2",value:function(){var e=this;this.dbg_enableRender&&d3.selectAll(".signalRow").each((function(){e.drawWave(d3.select(this))}))}},{key:"drawWave",value:function(e){var t=this,n=e.select(".signalWave"),i=e.select(".signalValues"),a=n.datum();function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return o(e)?parseInt(e):t}function s(e){return o(e)?"#00FF00":"z"==e?"#0000FF":"#FF0000"}var l=a.simObj.signal.wave.reduce((function(e,n,i){return t.waveIInRenderRange(a.simObj.signal,i)&&e.push([a,i]),e}),[]);if(n.classed("wave-style-".concat(a.waveStyle),!0),"bit"==a.waveStyle){var c=n.selectAll(".timeholder").data(l,(function(e){return e[1]}));c.exit().remove(),c=c.enter().append("line").classed("timeholder",!0);var u=n.selectAll(".valuechanger").data(l.slice(1),(function(e){return e[1]}));u.exit().remove(),u=u.enter().append("line").classed("valuechanger",!0);var d=n.selectAll(".transparent-rect").data(l,(function(e){return e[1]}));d.exit().remove(),(d=d.enter().append("rect").classed("transparent-rect",!0)).attr("x",(function(e){return t.initialTimeScale(e[0].getTimeAtI(e[1]))})).attr("y",(function(e){return t.bitWaveScale(r(e[0].getValueAtI(e[1])))})).attr("width",(function(e){return t.initialTimeScale(e[0].getTimeAtI(e[1]+1)-e[0].getTimeAtI(e[1]))})).attr("height",(function(e){return t.bitWaveScale(1-r(e[0].getValueAtI(e[1])))-2})).style("fill",(function(e){return s(e[0].getValueAtI(e[1]))})),c.attr("x1",(function(e){return t.initialTimeScale(e[0].getTimeAtI(e[1]))})).attr("y1",(function(e){return t.bitWaveScale(r(e[0].getValueAtI(e[1])))})).attr("x2",(function(e){return t.initialTimeScale(e[0].getTimeAtI(e[1]+1))})).attr("y2",(function(e){return t.bitWaveScale(r(e[0].getValueAtI(e[1])))})).style("stroke",(function(e){return s(e[0].getValueAtI(e[1]))})).attr("vector-effect","non-scaling-stroke"),u.attr("x1",(function(e){return t.initialTimeScale(e[0].getTimeAtI(e[1]))})).attr("y1",(function(e){return t.bitWaveScale(r(e[0].getValueAtI([e[1]-1])))})).attr("x2",(function(e){return t.initialTimeScale(e[0].getTimeAtI(e[1]))})).attr("y2",(function(e){return t.bitWaveScale(r(e[0].getValueAtI(e[1])))})).style("stroke",(function(e){return s(e[0].getValueAtI(e[1]))})).attr("vector-effect","non-scaling-stroke")}else{if("bus"!=a.waveStyle)return n.append("rect").attr("height",P.rowHeight).attr("width",V.now).attr("fill","rgba(180, 0, 0, 0.5)"),void n.append("text").text("Unsupported waveStyle: ".concat(a.waveStyle)).attr("y",P.rowHeight/2).attr("x",10).attr("text-anchor","left").attr("alignment-baseline","middle");var h=n.selectAll("path").data(l,(function(e){return e[1]})),v=i.selectAll(".bus-value-group").data(l,(function(e){return e[1]}));h.exit().remove(),v.exit().remove(),h=h.enter().append("path").classed("bus-path",!0),v=v.enter().append("g").classed("bus-value-group",!0).append("text").classed("bus-value",!0),h.attr("vector-effect","non-scaling-stroke").style("stroke",(function(e){return s(e[0].getValueAtI(e[1]))})).style("fill",(function(e){return s(e[0].getValueAtI(e[1]))})).style("stroke-width","2"),n.selectAll(".bus-path").attr("d",(function(e){var n="";return n+="M".concat(e[0].getTimeAtI(e[1]+1)-t.timeScale.invert(2),",").concat(t.bitWaveScale(1)," "),n+="".concat(e[0].getTimeAtI(e[1])+t.timeScale.invert(2),",").concat(t.bitWaveScale(1)," "),n+="".concat(e[0].getTimeAtI(e[1]),",").concat(t.bitWaveScale(.5)," "),n+="".concat(e[0].getTimeAtI(e[1])+t.timeScale.invert(2),",").concat(t.bitWaveScale(0)," "),n+="".concat(e[0].getTimeAtI(e[1]+1)-t.timeScale.invert(2),",").concat(t.bitWaveScale(0)," "),e[0].getTimeAtI(e[1]+1)<V.now&&(n+="".concat(e[0].getTimeAtI(e[1]+1),",").concat(t.bitWaveScale(.5)," "),n+="".concat(e[0].getTimeAtI(e[1]+1)-t.timeScale.invert(2),",").concat(t.bitWaveScale(1)," ")),n}));var f=this;v.text((function(e){return e[0].getValueAtI(e[1])})).attr("y",P.rowHeight/2).attr("x",(function(e){return t.timeScale(e[0].getTimeAtI(e[1])+e[0].getTimeAtI(e[1]+1))/2})).each((function(e){!function(e,t){if(t<5)return"";var n=t/10-1,i=(e=d3.select(e)).text();i.length>n&&(i=i.slice(0,n),e.text(i+"..."))}(this,f.timeScale(e[0].getTimeAtI(e[1]+1)-e[0].getTimeAtI(e[1])))}))}}},{key:"waveIInRenderRange",value:function(e,t){var n=e.getTimeAtI(t),i=e.getTimeAtI(t+1),a=d3.min(this.renderTimeScale.domain());return n<=d3.max(this.renderTimeScale.domain())&&i>=a}},{key:"dbg_setEnableUpdateRenderRange",value:function(e){this.dbg_enableUpdateRenderRange=e}},{key:"dbg_setEnableRender",value:function(e){this.dbg_enableRender=e}}])&&N(t.prototype,n),e}();function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var G=function(){function e(t){var n=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.constructor!=v)throw"ERROR";this.simDB=t,this.tree=new A,this.nameCol=new j(this),this.valueCol=new E(this),this.wave=new z(this),$("#main-container-scroll-y").scroll((function(){return n.wave.updateAxis()})),$(window).resize((function(){return n.wave.updateAxis()}))}var t,n;return t=e,(n=[{key:"reload",value:function(){this.nameCol.init(),this.valueCol.init(),this.wave.init(),this.nameCol.reload(),this.valueCol.reload(),this.wave.reload()}},{key:"refresh",value:function(){this.nameCol.refresh(),this.valueCol.refresh(),this.wave.refresh()}},{key:"clearAll",value:function(){this.nameCol.clearAll(),this.valueCol.clearAll(),this.wave.clearAll()}},{key:"selectRow",value:function(e){this.nameCol.selectRow(e),this.valueCol.selectRow(e),this.wave.selectRow(e)}},{key:"deSelectRow",value:function(e){this.nameCol.deSelectRow(e),this.valueCol.deSelectRow(e),this.wave.deSelectRow(e)}},{key:"moveRow",value:function(e,t,n){this.tree.move(e,t,n),this.nameCol.moveRow(e,t,n),this.valueCol.moveRow(e,t,n),this.wave.moveRow(e,t,n)}},{key:"openGroup",value:function(e){this.tree.open(e),this.nameCol.openGroup(e),this.valueCol.openGroup(e),this.wave.openGroup(e)}},{key:"closeGroup",value:function(e){this.tree.close(e),this.nameCol.closeGroup(e),this.valueCol.closeGroup(e),this.wave.closeGroup(e)}},{key:"insertRow",value:function(e,t,n){this.tree.insert(e.id,t,n,e),this.nameCol.insertRow(e.id,t,n),this.valueCol.insertRow(e.id,t,n),this.wave.insertRow(e.id,t,n)}},{key:"removeRow",value:function(e){this.tree.remove(e),this.nameCol.removeRow(e),this.valueCol.removeRow(e),this.wave.removeRow(e)}},{key:"removeRows",value:function(e){var t=this;void 0===e&&(e=this.getSelectedRows()),e.forEach((function(e){t.removeRow(e)}))}},{key:"insertWaveSignal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=this.simDB.getObject(e),r=new S(a);if(this.insertRow(r,t,n),i&&"bus"==r.waveStyle)for(var o=0;o<a.signal.width;o++){var s=a.cloneRange(o),l=new S(s);this.insertRow(l,r.id,o)}return r.id}},{key:"addAllWaveSignal",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(var t in e&&(this.tree=new A),this.simDB.objects)Object.prototype.hasOwnProperty.call(this.simDB.objects,t)&&this.simDB.objects[t].type==d.Type.SIGNAL&&this.insertWaveSignal(t.split("."))}},{key:"addObjects",value:function(e){var t=this;e.forEach((function(e){return t.insertWaveSignal(e)}))}},{key:"getRows",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.traverse,n=void 0===t?A.Traverse.PREORDER:t,i=e.parent,a=void 0===i?null:i,r=e.hidden,o=void 0===r||r,s=e.content,l=void 0!==s&&s,c=l?"data":null;return this.tree.getChildren(a,n,c,o)}},{key:"getRow",value:function(e){var t=e.id,n=e.content,i=void 0!==n&&n,a=this.get(t);return i?a.data:a}},{key:"getSelectedRows",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return t?this.nameCol.getSelectedRows():this.nameCol.getSelectedRows().map((function(t){return e.tree.get(t).data}))}},{key:"getActiveRow",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.nameCol.getActiveRow();return e?t:this.tree.get(t).data}},{key:"rename",value:function(e,t){this.tree.get(e).data.name=t,this.nameCol.reload()}},{key:"setRadix",value:function(e,t){var n=this;void 0===t&&(t=this.getSelectedRows()),t.forEach((function(t){n.tree.get(t).forEach((function(t){t.data.setRadix(e)})),n.valueCol.setRadix(t),n.wave.setRadix(t)}))}},{key:"moveCursorTo",value:function(e){this.wave.moveCursorTo(e),this.valueCol.showValuesAt(e)}},{key:"getCursorTime",value:function(){return this.wave.getCursorTime()}},{key:"zoomFit",value:function(){this.wave.zoomFit()}},{key:"zoomAutoscale",value:function(){this.wave.zoomAutoscale()}},{key:"zoomIn",value:function(){this.wave.zoomIn()}},{key:"zoomOut",value:function(){this.wave.zoomOut()}}])&&W(t.prototype,n),e}(),P={},V=new v,D=new G(V);function L(e){var t;console.log(e),V.init(((t=e).signals=t.children,delete t.children,t)),D.addAllWaveSignal(),V.updateDBInitialX(),new g(D).showTree(),console.log(V),setTimeout((function(){D.wave.init(),D.reload(),setTimeout((function(){D.moveCursorTo(0),D.wave.zoomAutoscale()}),0)}),0)}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;void 0===e?D.getSelectedRows().forEach((function(e){B(e)})):($("#names-col-container-scroll").jstree().deselect_node("signal-name-".concat(e)),$("#values-col-container").jstree().deselect_node("signal-value-".concat(e)),d3.selectAll(".".concat(e)).classed("highlighted-signal",!1),setTimeout((function(){0==D.getSelectedRows().length&&F(e,!1)}),10))}function F(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&B(),d3.selectAll(".".concat(e)).classed("highlighted-signal",!0),$("#names-col-container-scroll").jstree().select_node("signal-name-".concat(e)),$("#values-col-container").jstree().select_node("signal-value-".concat(e))}$(".demo-file-button").click((function(){$.ajax({url:"parse-vcd",type:"POST",data:JSON.stringify({fname:$(this).attr("data-file"),other_fields:{a:1,b:null}}),contentType:"application/json; charset=utf-8",dataType:"json",success:L})})),$("#zoom-fit").click((function(){D.zoomFit()})),$("#zoom-autoscale").click((function(){D.zoomAutoscale()})),$("#zoom-in").click((function(){D.zoomIn()})),$("#zoom-out").click((function(){D.zoomOut()})),$("#remove-all").click((function(){D.removeAllSignals()})),$("#cursor-to-0").click((function(){D.moveCursorTo(0)})),$("#cursor-to-end").click((function(){D.moveCursorTo(V.now)})),$("#cursor-to-prev-transition").click((function(){var e=D.getCursorTime(),t=D.getActiveRow(!1).simObj.getTimeAnyTransition(e,-1);D.moveCursorTo(t)})),$("#cursor-to-next-transition").click((function(){var e=D.getCursorTime(),t=D.getActiveRow(!1).simObj.getTimeAnyTransition(e,1);D.moveCursorTo(t)})),$(".resizable-col").resizable({handles:"e"}),$(".dbg_updateRenderRange").click((function(){var e=$(this).is(":checked");D.wave.dbg_setEnableUpdateRenderRange(e),$(".dbg_updateRenderRange").prop("checked",e)})),$(".dbg_enableRender").click((function(){var e=$(this).is(":checked");D.wave.dbg_setEnableRender(e),$(".dbg_enableRender").prop("checked",e)})),$("#file-open-button").click((function(){$("#file-open-shadow").click()})),$("#fileopenmenu").click((function(){$("#file-open-shadow").click()})),$("#file-open-shadow").on("change",(function(e){var t=e.target,n=new FileReader;n.readAsText(t.files[0],"UTF-8"),n.onload=function(e){console.log(e.target.result),$.ajax({url:"parse-vcd",type:"POST",data:JSON.stringify({fname:t.files[0].name,content:e.target.result}),contentType:"application/json; charset=utf-8",dataType:"json",success:L})}})),$.ajax({url:"defaults.json",dataType:"json",success:function(e){P=e,$(".resizable-col").resizable({handles:"e"})},error:function(e,t,n){alert("While getting defaults.json: ".concat(t," ").concat(n))}}),$((function(){$.contextMenu({selector:".signal-context-menu, #names-col-container .jstree-node, #values-col-container .jstree-node",callback:function(e,t){switch(!0){case/rename/.test(e):setTimeout((function(){D.nameCol.editName(D.getActiveRow())}),0);break;case/remove/.test(e):setTimeout((function(){D.removeRows()}),0);break;case/radix-.+/.test(e):setTimeout((function(){D.setRadix(e.split("-")[1])}),0);break;case/waveStyle-.+/.test(e):break;default:console.log("unknown key: ".concat(e))}},build:function(e,t){for(var n=t.target;!$(n).hasClass("signal-highlighter");)if(null===(n=n.parentElement))return console.log("ERROR tarrg is null"),{};return D.getSelectedRows().length<=1&&F(d3.select(t.target).datum().id),{}},zIndex:1100,items:{rename:{name:"Rename",icon:"edit"},waveStyle:{name:"Wave Style",items:{"waveStyle-analog":{name:"analog"},"waveStyle-bus":{name:"bus"}}},radix:{name:"Radix",items:{"radix-bin":{name:"bin"},"radix-hex":{name:"hex"},"radix-signed":{name:"signed"},"radix-unsigned":{name:"unsigned"}}},sep1:"---------",group:{name:"New Group"},virtualBus:{name:"New Virtual Bus"},divider:{name:"New Divider"},sep2:"---------",remove:{name:"Remove",icon:"delete"}}})}))}},t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(734)})();